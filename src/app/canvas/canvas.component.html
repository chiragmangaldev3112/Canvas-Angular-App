<div class="container-fluid p-3">
  <div class="card">
    <div class="card-header bg-white">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Canvas Editor</h4>
        <div>
          <a routerLink="/kidney-marker" class="btn btn-info btn-sm me-2">
            <i class="bi bi-heart-pulse me-1"></i> Kidney Marker
          </a>
          
          <!-- Media Capture Buttons -->
          <button class="btn btn-success btn-sm me-2" (click)="openMediaCapture('image')">
            <i class="bi bi-camera me-1"></i> Capture Image
          </button>
          <button class="btn btn-warning btn-sm me-2" (click)="openMediaCapture('video')">
            <i class="bi bi-camera-video me-1"></i> Capture Video
          </button>
          <button class="btn btn-secondary btn-sm me-2" (click)="openMediaCapture('audio')">
            <i class="bi bi-mic me-1"></i> Capture Audio
          </button>
          
          <button class="btn btn-primary btn-sm me-2" (click)="saveCanvas()">
            <i class="bi bi-save me-1"></i> Save
          </button>
          <button class="btn btn-outline-secondary btn-sm" (click)="openClearCanvasModal()">
            <i class="bi bi-trash me-1"></i> Clear
          </button>
        </div>
      </div>
    </div>
    
    <app-confirm-clear-modal
      [visible]="showClearModal"
      (confirm)="handleClearConfirm()"
      (cancel)="handleClearCancel()"
    ></app-confirm-clear-modal>
    
    <div class="card-body p-3">
      <div class="d-flex align-items-center mb-3">
        <span class="text-muted me-2">Add Shape:</span>
        <div class="btn-group me-3">
          <button 
            class="btn btn-outline-secondary btn-sm" 
            [class.active]="selectedShapeType === 'circle'"
            (click)="setSelectedShape('circle')"
            title="Add Circle">
            <i class="bi bi-circle"></i> Circle
          </button>
          <button 
            class="btn btn-outline-secondary btn-sm"
            [class.active]="selectedShapeType === 'square'"
            (click)="setSelectedShape('square')"
            title="Add Square">
            <i class="bi bi-square"></i> Square
          </button>
        </div>
        
        <button 
          class="btn btn-outline-danger btn-sm ms-auto" 
          *ngIf="selectedShapeId"
          (click)="deleteSelectedShape()">
          <i class="bi bi-trash me-1"></i> Delete Selected
        </button>
      </div>
      
      <div class="canvas-flex-row">
        <!-- Left: Shape Palette -->
        <div class="shape-palette" tabindex="0">
          <div class="palette-title">Shapes</div>
          <div class="palette-list">
            <div 
              class="palette-item"
              *ngFor="let item of shapePalette"
              [attr.data-type]="item.type"
              draggable="true"
              (dragstart)="onShapePaletteDragStart($event, item)"
            >
              <i [class]="'bi ' + item.icon" [style.color]="item.color" style="font-size: 2rem;"></i>
              <span class="palette-label">{{item.label}}</span>
            </div>
          </div>
        </div>

        <!-- Right: Canvas -->
        <div class="canvas-container">
          <div 
            class="canvas" 
            #canvas
            (click)="onCanvasClick($event)"
            (contextmenu)="onContextMenu($event)"
            (dragover)="onCanvasDragOver($event)"
            (drop)="onCanvasDrop($event)"
          >
            <app-shape 
              *ngFor="let shape of shapes" 
              [shape]="shape"
              [isSelected]="selectedShapeId === shape.id"
              (delete)="deleteSelectedShape()">
            </app-shape>
          </div>
        </div>
      </div>
      
      <div *ngIf="!shapes.length" class="d-flex h-100 align-items-center justify-content-center text-muted p-5">
        <div class="text-center">
          <i class="bi bi-lightbulb" style="font-size: 2rem;"></i>
          <p class="mt-2 mb-0">Click on a shape button above to add it to the canvas</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Media Capture Modal -->
<app-media-capture-modal
  [visible]="showMediaCaptureModal"
  [mode]="mediaCaptureMode"
  (onCapture)="handleMediaCapture($event)"
  (onCancel)="handleMediaCaptureCancel()">
</app-media-capture-modal>
